# Backend API Access Guide

This document provides instructions on how to connect to and interact with the Recipes Backend API.

## Base URL

The API is typically available at:
`http://localhost:8000` (or the port configured when running the Uvicorn server via `uvicorn app.backend:app --reload`)

All endpoint paths below are relative to this base URL.

## Authentication

Most endpoints require authentication. The API likely uses OAuth2 with JWT Bearer tokens (this should be confirmed by checking `app/auth.py` or `app/backend.py`).

**To obtain an access token (Example Flow):**
1.  Send a request to an authentication endpoint (e.g., `/token` or `/auth/login` - **please verify the exact path**).
    *   **Method**: `POST`
    *   **Content-Type**: `application/x-www-form-urlencoded` or `application/json`
    *   **Body (form-urlencoded example)**: `username=YOUR_USERNAME&password=YOUR_PASSWORD`
2.  The response will typically contain an `access_token`.

**To use the access token:**
Include it in the `Authorization` header for subsequent API requests:
`Authorization: Bearer YOUR_ACCESS_TOKEN`

*(Note: Specific details about user registration, the exact token endpoint path, and request/response formats for authentication should be confirmed from the application's authentication implementation.)*

## Endpoints

### 1. Recipe Extraction

#### Obtain and Process Recipe from URL
*   **Endpoint**: `/obtainrecipe`
*   **Method**: `POST`
*   **Description**: Submits a URL of a recipe page. The backend fetches the HTML, converts it to Markdown, extracts recipe details using an AI agent, and stores it in the database.
*   **Requires Authentication**: Yes (assumed, please verify)
*   **Request Body**:
    ```json
    {
        "url": "YOUR_RECIPE_URL"
    }
    ```
*   **Success Response (200 OK or 201 Created)**:
    *   **Content-Type**: `application/json`
    *   **Body**: The created `Recipe` object (see Data Models section).
    ```json
    {
        "id": 1,
        "title": "Delicious Pancakes",
        "ingredients": ["flour", "eggs", "milk"],
        "instructions": "Mix all ingredients...",
        "source_url": "YOUR_RECIPE_URL"
        // ... other fields from Recipe model
    }
    ```
*   **Error Responses**:
    *   `400 Bad Request`: Invalid URL or request format.
    *   `401 Unauthorized`: Authentication failed or token missing/invalid.
    *   `422 Unprocessable Entity`: Validation error (e.g., invalid URL format).
    *   `500 Internal Server Error`: Error during processing.

### 2. Recipe Management (CRUD)

*(Note: The existence and exact paths/methods for all CRUD operations below, other than the confirmed `PUT` endpoint, should be verified against `app/backend.py`.)*

#### Create a Recipe (Directly)
*   **Endpoint**: `/recipes/`
*   **Method**: `POST`
*   **Description**: Allows creating a recipe by directly providing its details.
*   **Requires Authentication**: Yes
*   **Request Body**: A `Recipe` object (without the `id`, as it will be auto-generated by the database).
    ```json
    {
        "title": "Spaghetti Carbonara",
        "ingredients": ["spaghetti", "eggs", "pancetta", "parmesan", "black pepper"],
        "instructions": "Cook spaghetti. Fry pancetta. Mix eggs and cheese. Combine.",
        "source_url": "optional_source_url"
        // ... other fields from Recipe model
    }
    ```
*   **Success Response (201 Created)**: The created `Recipe` object with its new `id`.
*   **Error Responses**:
    *   `401 Unauthorized`.
    *   `422 Unprocessable Entity`: Validation error.

#### List All Recipes
*   **Endpoint**: `/recipes/`
*   **Method**: `GET`
*   **Description**: Retrieves a list of all stored recipes.
*   **Requires Authentication**: Yes
*   **Query Parameters (Optional)**:
    *   `skip` (int, default 0): Number of recipes to skip for pagination.
    *   `limit` (int, default 100): Maximum number of recipes to return.
*   **Success Response (200 OK)**: A list of `Recipe` objects.
    ```json
    [
        { "id": 1, "title": "Pancakes", "ingredients": [...], ... },
        { "id": 2, "title": "Waffles", "ingredients": [...], ... }
    ]
    ```
*   **Error Responses**:
    *   `401 Unauthorized`.

#### Get a Specific Recipe
*   **Endpoint**: `/recipes/{recipe_id}`
*   **Method**: `GET`
*   **Description**: Retrieves a single recipe by its ID.
*   **Requires Authentication**: Yes
*   **Path Parameters**:
    *   `recipe_id` (int): The ID of the recipe to retrieve.
*   **Success Response (200 OK)**: The `Recipe` object.
*   **Error Responses**:
    *   `401 Unauthorized`.
    *   `404 Not Found`: Recipe with the given ID does not exist.

#### Update a Recipe
*   **Endpoint**: `/recipes/{recipe_id}`
*   **Method**: `PUT`
*   **Description**: Updates an existing recipe. Uses the `RecipeUpdate` model, allowing partial updates (fields not provided in the request body will retain their current values).
*   **Requires Authentication**: Yes
*   **Path Parameters**:
    *   `recipe_id` (int): The ID of the recipe to update.
*   **Request Body**: A `RecipeUpdate` object (see Data Models section).
    ```json
    {
        "title": "Updated Pancake Title",
        "ingredients": ["flour", "eggs", "milk", "sugar"], // Example: updated ingredients
        "servings": "Makes 10"
        // ... other fields to update from RecipeUpdate model
    }
    ```
*   **Success Response (200 OK)**: The updated `Recipe` object.
*   **Error Responses**:
    *   `401 Unauthorized`.
    *   `404 Not Found`: Recipe with the given ID does not exist.
    *   `422 Unprocessable Entity`: Validation error.

#### Delete a Recipe
*   **Endpoint**: `/recipes/{recipe_id}`
*   **Method**: `DELETE`
*   **Description**: Deletes a recipe by its ID.
*   **Requires Authentication**: Yes
*   **Path Parameters**:
    *   `recipe_id` (int): The ID of the recipe to delete.
*   **Success Response (200 OK or 204 No Content)**: Typically a confirmation message or no content.
    ```json
    {
        "message": "Recipe deleted successfully"
    }
    ```
    Or an empty response with status 204.
*   **Error Responses**:
    *   `401 Unauthorized`.
    *   `404 Not Found`: Recipe with the given ID does not exist.

## Data Models

The API uses Pydantic models for request and response validation. Key models are defined in `app/models/recipe.py`.

### `Recipe` (Pydantic Model)
Used for creating recipes (in `POST /recipes/` request body, without `id`) and in API responses (with `id`).
```python
# Example structure (refer to app/models/recipe.py for exact fields)
# class Recipe(BaseModel):
#     id: Optional[int] = None # Auto-generated by DB, present in responses
#     title: str
#     ingredients: List[str]
#     instructions: str
#     servings: Optional[str] = None
#     prep_time: Optional[str] = None
#     cook_time: Optional[str] = None
#     total_time: Optional[str] = None
#     cuisine: Optional[str] = None
#     course: Optional[str] = None
#     source_url: Optional[HttpUrl] = None # pydantic.HttpUrl
#     image_url: Optional[HttpUrl] = None
```

### `RecipeUpdate` (Pydantic Model)
Used for updating recipes (`PUT /recipes/{recipe_id}`). All fields are optional.
```python
# Example structure (refer to app/models/recipe.py for exact fields)
# class RecipeUpdate(BaseModel):
#     title: Optional[str] = None
#     ingredients: Optional[List[str]] = None
#     instructions: Optional[str] = None
#     servings: Optional[str] = None
#     prep_time: Optional[str] = None
#     cook_time: Optional[str] = None
#     total_time: Optional[str] = None
#     cuisine: Optional[str] = None
#     course: Optional[str] = None
#     source_url: Optional[HttpUrl] = None
#     image_url: Optional[HttpUrl] = None
```

---
**Disclaimer**: This document is based on available project memories and common REST API practices. Always refer to the source code (especially `app/backend.py`, `app/auth.py`, and `app/models/recipe.py`) for the most accurate and up-to-date details on endpoints, authentication, and data models.
